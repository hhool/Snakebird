<!DOCTYPE html>
<html>
 <head>
  <meta charset="UTF-8" />
  <title>
   Snakebird
  </title>
  <link rel="shortcut icon" href="snakebird.ico" />
  <script language="javascript" type="text/javascript">
   //<!--

    let FONTS_WERE_LOADED = false;

   //-->
  </script>
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
  <script language="javascript" type="text/javascript" src="js/levels/std_lvls.js"></script>
  <script language="javascript" type="text/javascript" src="js/levels/gravity_lvls.js"></script>
  <script language="javascript" type="text/javascript" src="js/levels/infinity_lvls.js"></script>
  <script language="javascript" type="text/javascript" src="js/levels/snakefall_lvls.js"></script>
  <script language="javascript" type="text/javascript" src="js/levels/dev_lvls.js"></script>
  <script language="javascript" type="text/javascript" src="js/ds.js"></script>
  <script language="javascript" type="text/javascript" src="js/GameState.js"></script>
  <script language="javascript" type="text/javascript" src="js/gameTransition.js"></script>
  <script language="javascript" type="text/javascript" src="js/GameSolver.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/draw-utils.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/bezier.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/text.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/button.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/spikes.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/obstacle.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/cloud.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/target.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/portal.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/fruit.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/portation-utils.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/block-utils.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/block.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/snake.js"></script>
  <script language="javascript" type="text/javascript" src="js/graphics/mountain.js"></script>
  <script language="javascript" type="text/javascript" src="js/GameDrawer.js"></script>
  <script language="javascript" type="text/javascript" src="js/GameBoard.js"></script>
  <script language="javascript" type="text/javascript" src="js/LocalStorageHelper.js"></script>
  <script language="javascript" type="text/javascript" src="js/level-editor-utils.js"></script>
  <script language="javascript" type="text/javascript" src="js/LevelEditor.js"></script>
  <script language="javascript" type="text/javascript" src="js/LevelSelector.js"></script>
  <script language="javascript" type="text/javascript">
   //<!--

    let levelSel, htmlWasLoaded = false, fontWasLoaded = false;

    WebFont.load({
      google: {
        families: ['Fredoka One']
      },
      active: () => fontsLoaded()
    });

    function fontsLoaded() {
      FONTS_WERE_LOADED = true;
      if (levelSel) levelSel.redraw();
    }

    function main() {
      if (!levelSel)
        levelSel = new LevelSelector(document.body, [
          new LevelCollection('Snakebird Original', std_levels),
          new LevelCollection('Which way is up?', gravity_levels),
          new LevelCollection('Endless Space', infinity_levels),
          new LevelCollection('Snakefall', snakefall_levels),
          new LevelCollection('Development Levels', dev_levels)
        ]);
    }

    document.addEventListener('DOMContentLoaded', () => main());

   //-->
  </script>
  <link rel="stylesheet" type="text/css" href="css/level-editor.css" />
  <link rel="stylesheet" type="text/css" href="css/level-selector.css" />
  <link rel="stylesheet" type="text/css" href="css/mf-file-selector.css" />
  <style type="text/css">
   
  </style>
 </head>
 <body onLoad="main();">
  
  <div id="dump-ui-root">
    <button id="dump-styles-btn" aria-label="Dump styles">Dump styles</button>
    <div id="dump-overlay" role="dialog" aria-hidden="true">
      <div id="dump-panel">
        <div id="dump-panel-head">
          <strong>Page styles dump</strong>
          <button id="dump-close">Close</button>
        </div>
        <textarea id="dump-json" readonly></textarea>
        <div id="dump-panel-foot">
          <button id="dump-copy">Copy JSON</button>
          <button id="dump-download">Download</button>
        </div>
      </div>
    </div>
  </div>

  <style>
    #dump-styles-btn{position:fixed;right:8px;top:8px;z-index:99999;padding:6px 10px;background:#1e88e5;color:#fff;border:0;border-radius:6px;font-size:13px}
    #dump-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:99998}
    #dump-overlay[aria-hidden="false"]{display:flex}
    #dump-panel{width:min(980px,95%);height:min(600px,80%);background:#fff;border-radius:8px;box-shadow:0 6px 24px rgba(0,0,0,0.3);display:flex;flex-direction:column;overflow:hidden}
    #dump-panel-head{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #eee}
    #dump-json{flex:1;padding:12px;border:0;width:100%;resize:none;font-family:monospace;font-size:12px}
    #dump-panel-foot{display:flex;gap:8px;padding:10px;justify-content:flex-end;border-top:1px solid #eee}
    #dump-panel button{padding:6px 10px;border-radius:6px;border:0;background:#1976d2;color:#fff}
  </style>

  <script>
    (function(){
      function isDumpEnabled(){
        try{
          const params = new URLSearchParams(location.search);
          if(params.get('dump') === '1') return true;
          if(location.hash && location.hash.indexOf('dump') !== -1) return true;
        }catch(e){ }
        return false;
      }

      // If not enabled, hide the dump UI root and skip wiring the handlers.
      if(!isDumpEnabled()){
        const root = document.getElementById('dump-ui-root');
        if(root) root.style.display = 'none';
        return;
      }

      const btn = document.getElementById('dump-styles-btn');
      const overlay = document.getElementById('dump-overlay');
      const ta = document.getElementById('dump-json');
      const closeBtn = document.getElementById('dump-close');
      const copyBtn = document.getElementById('dump-copy');
      const dlBtn = document.getElementById('dump-download');

      function serializeEl(el){
        if(!el) return null;
        const cs = window.getComputedStyle(el);
        const rect = el.getBoundingClientRect();
        return {
          tag: el.tagName,
          id: el.id || null,
          classes: Array.from(el.classList || []),
          transform: cs.transform || 'none',
          position: cs.position || 'static',
          width: cs.width || rect.width + 'px',
          height: cs.height || rect.height + 'px',
          overflow: cs.overflow || '',
          display: cs.display || '',
          willChange: cs.willChange || '',
          rect: { left: Math.round(rect.left), top: Math.round(rect.top), width: Math.round(rect.width), height: Math.round(rect.height) }
        };
      }

      function ancestorsInfo(el){
        const arr = [];
        let cur = el.parentElement;
        while(cur){
          arr.push(serializeEl(cur));
          if(cur.tagName === 'BODY') break;
          cur = cur.parentElement;
        }
        return arr;
      }

      function collect(){
        const canvases = Array.from(document.querySelectorAll('canvas')).map(c => {
          return { info: serializeEl(c), ancestors: ancestorsInfo(c) };
        });
        const wrapper = document.getElementById('app-scale-wrapper');
        const levelSel = document.querySelector('.lvl-sel-outer-container');
        const levelMenu = document.querySelector('.lvl-menu-outer-container');
        const data = {
          canvases: canvases.map(c=>c.info),
          wrapper: { info: serializeEl(wrapper), ancestors: wrapper ? ancestorsInfo(wrapper) : [] },
          body: serializeEl(document.body),
          levelSelector: { info: serializeEl(levelSel), ancestors: levelSel ? ancestorsInfo(levelSel) : [] },
          levelMenu: { info: serializeEl(levelMenu), ancestors: levelMenu ? ancestorsInfo(levelMenu) : [] },
          viewport: { innerWidth: window.innerWidth, innerHeight: window.innerHeight, dpr: window.devicePixelRatio || 1 },
          userAgent: navigator.userAgent
        };
        return data;
      }

      function showDump(){
        const data = collect();
        ta.value = JSON.stringify(data, null, 2);
        overlay.setAttribute('aria-hidden','false');
        ta.focus();
      }

      function hideDump(){ overlay.setAttribute('aria-hidden','true'); }

      async function copyDump(){
        const text = ta.value;
        try{
          if(navigator.clipboard && navigator.clipboard.writeText){
            await navigator.clipboard.writeText(text);
          } else {
            ta.select();
            document.execCommand('copy');
            window.getSelection().removeAllRanges();
          }
          copyBtn.textContent = 'Copied';
          setTimeout(()=>copyBtn.textContent='Copy JSON',1200);
        }catch(e){
          copyBtn.textContent = 'Copy failed';
          setTimeout(()=>copyBtn.textContent='Copy JSON',1200);
        }
      }

      function downloadDump(){
        const blob = new Blob([ta.value], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'dump.json';
        document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
      }

      btn.addEventListener('click', showDump);
      closeBtn.addEventListener('click', hideDump);
      copyBtn.addEventListener('click', copyDump);
      dlBtn.addEventListener('click', downloadDump);
      overlay.addEventListener('click', (e)=>{ if(e.target===overlay) hideDump(); });
    })();
  </script>
 </body>
</html>